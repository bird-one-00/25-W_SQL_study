# [25-W SQL 스터디] 3주차 공부

## 1. [가격대 별 상품 개수 구하기](https://school.programmers.co.kr/learn/courses/30/lessons/131530)
공부한 날짜: 2025년 1월 29일

### 작성한 SQL 쿼리
```SQL
SELECT (
    CASE WHEN PRICE < 10000 THEN 0
    ELSE TRUNCATE(PRICE, -4)
    END) AS PRICE_GROUP, COUNT(*) AS PRODUCTS
FROM PRODUCT
GROUP BY PRICE_GROUP
ORDER BY PRICE_GROUP;
```

### 함수 공부
```SQL
1. TRUNCATE 함수
TRUNCATE(number, decimals)

number: 버림할 숫자
decimals: 숫자의 소수점 이하 자릿수
-> decimals이 양수면 소수점 버림, 음수면 정수 버림하면 된다.

ex) PRICE = 12345의 경우, TRUNCATE(PRICE, -4)는 10000
ex) PRICE = 123456.789의 경우, TRUNCATE(PRICE, -4)는 120000
ex) PRICE = 123456.789의 경우, TRUNCATE(PRICE, -3)은 123000
ex) PRICE = 123456.789의 경우, TRUNCATE(PRICE, 3)은 123456.789 (소수점 기준으로 세 번째 자리까지 유지하고 이후를 버림)
ex) PRICE = 123456.789의 경우, TRUNCATE(PRICE, 2)는 123456.78
```


## 2. [연도 별 평균 미세먼지 농도 조회하기](https://school.programmers.co.kr/learn/courses/30/lessons/284530)
공부한 날짜: 2025년 1월 29일

### 작성한 SQL 쿼리
```SQL
SELECT
    YEAR(YM) AS YEAR,
    ROUND(AVG(PM_VAL1), 2) AS PM10,
    ROUND(AVG(PM_VAL2), 2) AS "PM2.5"
FROM AIR_POLLUTION
WHERE LOCATION2 = '수원'
GROUP BY YEAR
ORDER BY YEAR;
```


## 3. [물고기 종류 별 잡은 수 구하기](https://school.programmers.co.kr/learn/courses/30/lessons/293257)
공부한 날짜: 2025년 1월 29일

### 작성한 SQL 쿼리
```SQL
SELECT COUNT(*) AS FISH_COUNT, FISH_NAME
FROM FISH_NAME_INFO A
JOIN FISH_INFO B ON A.FISH_TYPE = B.FISH_TYPE
GROUP BY FISH_NAME
ORDER BY FISH_COUNT DESC;
```

### 함수 공부
```SQL
SQL에서는 GROUP BY에 포함되지 않은 컬럼을 SELECT 절에서 사용하면 오류가 발생함.

가령, 문제에서 물고기의 종류 별 물고기의 이름과 잡은 수를 출력하라고 해서
GROUP BY FISH_TYPE를 사용하면 에러가 발생함.
```


## 4. [ROOT 아이템 구하기](https://school.programmers.co.kr/learn/courses/30/lessons/273710)
공부한 날짜: 2025년 1월 29일

### 작성한 SQL 쿼리
```SQL
SELECT I.ITEM_ID, ITEM_NAME
FROM ITEM_INFO I
JOIN ITEM_TREE T ON I.ITEM_ID = T.ITEM_ID
WHERE PARENT_ITEM_ID IS NULL;
```


## 5. [월별 잡은 물고기 수 구하기](https://school.programmers.co.kr/learn/courses/30/lessons/293260)
공부한 날짜: 2025년 1월 29일

### 작성한 SQL 쿼리
```SQL
SELECT COUNT(*) AS FISH_COUNT, MONTH(TIME) AS MONTH
FROM FISH_INFO
GROUP BY MONTH
ORDER BY MONTH;
```


## 6. [조건에 맞는 사원 정보 조회하기](https://school.programmers.co.kr/learn/courses/30/lessons/284527)
공부한 날짜: 2025년 1월 29일

### 작성한 SQL 쿼리
```SQL
SELECT SUM(SCORE) AS SCORE, E.EMP_NO, EMP_NAME, POSITION, EMAIL
FROM HR_EMPLOYEES E
JOIN HR_GRADE G ON E.EMP_NO = G.EMP_NO
GROUP BY E.EMP_NO
ORDER BY SCORE DESC
LIMIT 1;
```


## 7. [재구매가 일어난 상품과 회원 리스트 구하기](https://school.programmers.co.kr/learn/courses/30/lessons/131536)
공부한 날짜: 2025년 1월 29일

### 작성한 SQL 쿼리
```SQL
SELECT USER_ID, PRODUCT_ID
FROM ONLINE_SALE
GROUP BY USER_ID, PRODUCT_ID
HAVING COUNT(*) >= 2
ORDER BY
    USER_ID ASC,
    PRODUCT_ID DESC;
```


## 8. [특정 물고기를 잡은 총 수 구하기](https://school.programmers.co.kr/learn/courses/30/lessons/298518)
공부한 날짜: 2025년 1월 30일

### 작성한 SQL 쿼리 1
```SQL
SELECT COUNT(*) AS FISH_COUNT
FROM FISH_INFO
WHERE FISH_TYPE IN (SELECT FISH_TYPE
       FROM FISH_NAME_INFO
       WHERE FISH_NAME IN ('BASS', 'SNAPPER')
       );
```

### 작성한 SQL 쿼리 2
```SQL
SELECT COUNT(*) AS FISH_COUNT
FROM FISH_INFO I
JOIN FISH_NAME_INFO N ON I.FISH_TYPE = N.FISH_TYPE
WHERE N.FISH_NAME IN ('BASS', 'SNAPPER');
```
2번째 방법이 좀 더 직관적으로 이해가 쉬운 것 같다.


## 9. [자동차 평균 대여 기간 구하기](https://school.programmers.co.kr/learn/courses/30/lessons/157342)
공부한 날짜: 2025년 1월 30일

### 작성한 SQL 쿼리
```SQL
SELECT
    CAR_ID,
    ROUND(AVG(DATEDIFF(END_DATE, START_DATE)+1) ,1) AS AVERAGE_DURATION
FROM CAR_RENTAL_COMPANY_RENTAL_HISTORY
GROUP BY CAR_ID
HAVING AVERAGE_DURATION >= 7
ORDER BY AVERAGE_DURATION DESC, CAR_ID DESC;
```

### 함수 공부
```SQL
1. DATEDIFF 함수에서 +1을 해야 하는 이유

렌트 기간을 구할 떄 렌트를 시작한 날을 포함하기 때문. 두 기간의 차이값에서 +1을 해줘야 함.
START_DATE	END_DATE
2022-09-27	2022-10-01

-> 여기에서 대여 기간이 5일이었기 때문에 시작하는 날짜를 포함하고 있음을 확인할 수 있음~
```


## 10. [노선별 평균 역 사이 거리 조회하기](https://school.programmers.co.kr/learn/courses/30/lessons/284531)
공부한 날짜: 2025년 1월 30일

### 작성한 SQL 쿼리
```SQL
SELECT
    ROUTE,
    CONCAT(ROUND(SUM(D_BETWEEN_DIST), 1), 'km') AS TOTAL_DISTANCE,
    CONCAT(ROUND(AVG(D_BETWEEN_DIST), 2), 'km') AS AVERAGE_DISTANCE
FROM SUBWAY_DISTANCE
GROUP BY ROUTE
ORDER BY SUM(D_BETWEEN_DIST) DESC;
```

### 함수 공부
```SQL
1. ORDER BY를 할 때는, 해당 행의 값이 숫자여야만 한다

ORDER BY TOTAL_DISTANCE를 하면 안 되는 이유
= TOTAL_DISTANCE는 CONCAT을 사용했기 때문에 문자열이 되었기 때문
```


## 11. [분기별 분화된 대장균의 개체 수 구하기](https://school.programmers.co.kr/learn/courses/30/lessons/299308)
공부한 날짜: 2025년 1월 30일

### 작성한 SQL 쿼리 1
```SQL
SELECT CASE
    WHEN MONTH(DIFFERENTIATION_DATE) BETWEEN 1 AND 3 THEN '1Q'
    WHEN MONTH(DIFFERENTIATION_DATE) BETWEEN 4 AND 6 THEN '2Q'
    WHEN MONTH(DIFFERENTIATION_DATE) BETWEEN 7 AND 9 THEN '3Q'
    ELSE '4Q'
    END AS QUARTER,
    COUNT(*) AS ECOLI_COUNT
FROM ECOLI_DATA
GROUP BY QUARTER
ORDER BY QUARTER;
```

### 작성한 SQL 쿼리 2
```SQL
SELECT CASE
        WHEN MONTH(DIFFERENTIATION_DATE) <= 3 THEN '1Q'
        WHEN MONTH(DIFFERENTIATION_DATE) <= 6 THEN '2Q'
        WHEN MONTH(DIFFERENTIATION_DATE) <= 9 THEN '3Q'
        ELSE '4Q' 
    END AS QUARTER,
    COUNT(*) AS ECOLI_COUNT
FROM ECOLI_DATA
GROUP BY QUARTER
ORDER BY QUARTER;
```

### 함수 공부
```SQL
CASE END 구문은 괄호()를 사용하면 안된다 !!! 할거면 (CASE ~~~ END) 로 써야함.
```