# [25-W SQL 스터디] 6주차 공부

## 1. [서울에 위치한 식당 목록 출력하기](https://school.programmers.co.kr/learn/courses/30/lessons/131118)
공부한 날짜: 2025년 2월 12일

### 작성한 SQL 쿼리
```SQL
SELECT
    I.REST_ID,
    I.REST_NAME,
    I.FOOD_TYPE,
    I.FAVORITES,
    I.ADDRESS,
    ROUND(AVG(REVIEW_SCORE), 2) AS SCORE
FROM REST_INFO I
    JOIN REST_REVIEW R ON I.REST_ID = R.REST_ID
GROUP BY I.REST_ID
HAVING I.ADDRESS LIKE '서울%'
ORDER BY SCORE DESC, I.FAVORITES DESC;
```


## 2. [저자 별 카테고리 별 매출액 집계하기](https://school.programmers.co.kr/learn/courses/30/lessons/144856)
공부한 날짜: 2025년 2월 12일

### 작성한 SQL 쿼리 1
```SQL
SELECT
    B.AUTHOR_ID,
    A.AUTHOR_NAME,
    B.CATEGORY,
    SUM(B.PRICE * S.SALES) AS TOTAL_SALES
FROM BOOK B
    JOIN AUTHOR A ON B.AUTHOR_ID = A.AUTHOR_ID
    JOIN BOOK_SALES S ON B.BOOK_ID = S.BOOK_ID
WHERE S.SALES_DATE IN (SELECT SALES_DATE
                      FROM BOOK_SALES
                      WHERE SALES_DATE LIKE '2022-01-%')
GROUP BY B.AUTHOR_ID, B.CATEGORY
ORDER BY B.AUTHOR_ID, B.CATEGORY DESC;
```

### 작성한 SQL 쿼리 2
```SQL
SELECT
    B.AUTHOR_ID,
    A.AUTHOR_NAME,
    B.CATEGORY,
    SUM(B.PRICE * S.SALES) AS TOTAL_SALES
FROM BOOK B
    JOIN AUTHOR A ON B.AUTHOR_ID = A.AUTHOR_ID
    JOIN BOOK_SALES S ON B.BOOK_ID = S.BOOK_ID
WHERE YEAR(S.SALES_DATE) = '2022'
    AND MONTH(S.SALES_DATE) = '01'
GROUP BY B.AUTHOR_ID, B.CATEGORY
ORDER BY B.AUTHOR_ID, B.CATEGORY DESC;
```
- 굳이 서브 쿼리를 안 풀어도 됐었다...
- 빨간 글씨 나오는 거 없이 한번에 풀었다. 기분이 너무 좋다ㅎㅎ


## 3. [년, 월, 성별 별 상품 구매 회원 수 구하기](https://school.programmers.co.kr/learn/courses/30/lessons/131532)
공부한 날짜: 2025년 2월 12일

### 작성한 SQL 쿼리
```SQL
SELECT
    YEAR(O.SALES_DATE) AS YEAR,
    MONTH(O.SALES_DATE) AS MONTH,
    U.GENDER AS GENDER,
    COUNT(DISTINCT U.USER_ID) AS USERS
FROM USER_INFO U
    JOIN ONLINE_SALE O ON U.USER_ID = O.USER_ID
WHERE U.GENDER IS NOT NULL
GROUP BY YEAR(O.SALES_DATE), MONTH(O.SALES_DATE), U.GENDER
ORDER BY YEAR, MONTH, GENDER;
```
> 동일한 날짜, 회원 ID, 상품 ID 조합에 대해서는 하나의 판매 데이터만 존재합니다. → 따라서 `DISTINCT` 사용


## 4. [우유와 요거트가 담긴 장바구니](https://school.programmers.co.kr/learn/courses/30/lessons/62284)
공부한 날짜: 2025년 2월 00일

### 작성한 SQL 쿼리
```SQL
```

### ✨이렇게 쉬웠으면 LV.4가 아니었겠지...
```SQL
SELECT CART_ID, NAME
FROM CART_PRODUCTS
WHERE NAME IN ('Milk', 'Yogurt')
GROUP BY CART_ID
ORDER BY CART_ID;
```
- Cart에 Yogurt가 2개 들어있는 경우도 있어서, 이렇게 작성하면 틀립니다...ㅠ (아니 왜 요거트를 2개나 사는거야...)


## 5. [주문량이 많은 아이스크림들 조회하기](https://school.programmers.co.kr/learn/courses/30/lessons/133027)
공부한 날짜: 2025년 2월 13일

### 작성한 SQL 쿼리
```SQL
SELECT F.FLAVOR
FROM FIRST_HALF F
    JOIN JULY J ON F.FLAVOR = J.FLAVOR
GROUP BY F.FLAVOR
ORDER BY SUM(F.TOTAL_ORDER) + SUM(J.TOTAL_ORDER) DESC
LIMIT 3;
```

### SQL 공부
1. 외래키
> FIRST_HALF테이블의 SHIPMENT_ID는 JULY테이블의 SHIPMENT_ID의 `외래 키`입니다.
- 문제 설명에 이런 문구가 있어서, 외래 키에 대해 공부해 보았다.
- 왜 JOIN을 할 때 SHIPMENT_ID가 아니라 FLAVOR로 해야 할까?


## 6. [연간 평가점수에 해당하는 평가 등급 및 성과금 조회하기](https://school.programmers.co.kr/learn/courses/30/lessons/284528)
공부한 날짜: 2025년 2월 16일

### 작성한 SQL 쿼리
```SQL
SELECT
    E.EMP_NO,
    EMP_NAME,
    CASE
        WHEN AVG(SCORE) >= 96 THEN 'S'
        WHEN AVG(SCORE) >= 90 THEN 'A'
        WHEN AVG(SCORE) >= 80 THEN 'B'
        ELSE 'C'
    END AS GRADE,
    CASE
        WHEN AVG(SCORE) >= 96 THEN SAL*0.2
        WHEN AVG(SCORE) >= 90 THEN SAL*0.15
        WHEN AVG(SCORE) >= 80 THEN SAL*0.1
        ELSE 0
    END AS BONUS
FROM HR_EMPLOYEES E
    JOIN HR_DEPARTMENT D ON E.DEPT_ID = D.DEPT_ID
    JOIN HR_GRADE G ON E.EMP_NO = G.EMP_NO
GROUP BY E.EMP_NO
ORDER BY E.EMP_NO;
```


## 7. [그룹별 조건에 맞는 식당 목록 출력하기](https://school.programmers.co.kr/learn/courses/30/lessons/131124)
공부한 날짜: 2025년 2월 16일

### 작성한 SQL 쿼리
```SQL
SELECT
    MEMBER_NAME,
    REVIEW_TEXT,
    DATE_FORMAT(REVIEW_DATE, '%Y-%m-%d') AS REVIEW_DATE
FROM REST_REVIEW R
    JOIN MEMBER_PROFILE M ON R.MEMBER_ID = M.MEMBER_ID
WHERE R.MEMBER_ID = (SELECT MEMBER_ID
                    FROM REST_REVIEW
                    GROUP BY MEMBER_ID
                    ORDER BY COUNT(*) DESC
                    LIMIT 1)
ORDER BY REVIEW_DATE, REVIEW_TEXT;
```

### 실행결과
![]()

리뷰가 참... 리얼하다...